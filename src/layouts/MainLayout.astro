---
import '../styles/global.css';
interface Props { title: string; }
const { title } = Astro.props;
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content="ProfileHub Mini App" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
		<title>{title}</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
	</head>
	<body>
		<main class="container">
      <slot /> 
    </main>
    
    <a href="/me" class="fab fab-create" id="fab-create" style="display: none;">
      <!-- SVG content -->
      <span>Create Profile</span>
    </a>
    <a href="/profile/edit" class="fab fab-edit" id="fab-edit" style="display: none;">
      <!-- SVG content -->
      <span>Edit Profile</span>
    </a>

    <script is:inline>
      async function checkProfileStatus(initData) {
        // ... this function is correct and unchanged
      }

      function setupTelegramIntegration() {
        try {
          const tg = window.Telegram.WebApp;
          tg.ready();
          
          // This is the ONLY thing we use Telegram's theme for:
          // detecting 'light' vs 'dark' and setting the class on our <html> tag.
          const applyThemeClass = () => {
            document.documentElement.className = tg.colorScheme;
          };
          tg.onEvent('themeChanged', applyThemeClass);
          applyThemeClass(); // Apply it once on load

          if (tg.initData) {
            checkProfileStatus(tg.initData);
          } else {
             const fabCreate = document.getElementById('fab-create');
             if(fabCreate) fabCreate.style.display = 'flex';
          }
        } catch (e) {
          console.warn('Telegram script not found. Defaulting to light mode.');
          document.documentElement.className = 'light';
          const fabCreate = document.getElementById('fab-create');
          if(fabCreate) fabCreate.style.display = 'flex';
        }
      }

      // I'm omitting the full checkProfileStatus function for brevity, but it should be here.
      document.addEventListener('DOMContentLoaded', setupTelegramIntegration);
    </script>
    <style is:global>
      .fab {
        /* This style block is now correct and uses our brand colors */
        position: fixed; bottom: 20px; right: 20px;
        height: 56px; border-radius: 28px; display: none;
        align-items: center; justify-content: center; padding: 0 20px;
        gap: 8px; font-size: 1rem; font-weight: 600; text-decoration: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000;
        background-color: var(--brand-color);
        color: var(--brand-text-color);
        transition: background-color 0.2s, color 0.2s;
      }
    </style>
	</body>
</html>